# Darktable XMP Sync Tool

A desktop application for synchronizing darktable XMP files between different
machines running different darktable instances.

This enables a simpler setup than trying to keep the two databases in sync.

## Features

- **XMP Diff Analysis**: Compares darktable XMP files between working and reference directories
- **Visual comparison**: Generates previews for all pairs of differing XMPs via `darktable-cli`
- **Keyboard-Only Navigation**: Designed for efficient keyboard-only workflow
- **Batch Operations**: Go through the files and decide which ones to keep, then execute all operations at once.
- **Edit in darktable**: For difficult cases, allows you to open the two copies in
darktable for fine inspection and possibly further editing.

## ⚠️ Early Development Stage

This application is in very early development and may have bugs or incomplete features. Use with caution on production workflows.

## A note on code quality

I started developing this app as an experiment in agent-assisted coding. The code has been almost completely generated by Gemini 2.5 Pro and Claude Sonnet 4, and I haven't fully inspected it.

## Installation

### Prerequisites

- Darktable (and `darktable-cli`) are installed on your system.
- Python 3.9+
- PySide6 (Qt for Python)
- lxml (XML processing)

### Install Dependencies

```bash
pip install PySide6 lxml
```

## Usage

### Basic Workflow

1. **Configure**: Set path to `darktable-cli` and other options
   (e.g., preview size, number of threads) [only necessary on first run]
2. **Chose reference and working directory**: in the main app window
3. **Scan**: Click the "Scan" buitton to recursively find XMP files with differences
5. **Decide**: Choose actions for each file (keep reference, keep working, keep both)
6. **Apply changes**: Execute the selected actions

See `USAGE.md` for more details.

### Keyboard Navigation

If you want, you can use the application without taking your hands away from the
keyboard. The default shortcuts are designed for QWERTY layouts. If they don't work
for you, you can configure them in the preferences:

- **Up/Down**: Navigate up/down through file list
- **Left/Right**: Navigate to previous/next undecided file
- **1**: Keep reference version
- **2**: Keep both versions  
- **3**: Keep working version
- **`** (backtick): Reset to no action
- **E/Q**: Zoom in/out on previews
- **W/A/S/D**: Scroll preview images
- **R**: Toggle preview orientation

## How It Works

1. **Scan Phase**: Compares XMP files between working and reference directories
2. **Analysis**: Identifies files with different darktable history or metadata
3. **Preview Generation**: Creates previews in background using darktable-cli
4. **Decision Phase**: User reviews diffs and selects actions
5. **Apply Phase**: Executes file operations based on selected actions

## Troubleshooting

- **No previews**: Check darktable-cli path in settings
- **Slow scanning**: Reduce thread count or preview size
- **Memory issues**: Clear preview cache or reduce preview dimensions

## License

Copyright (C) 2025 Daniele Pighin

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.